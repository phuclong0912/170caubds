<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi Chứng Chỉ BĐS - 50 Câu Ngẫu Nhiên</title>
    <style>
        body {font-family: Arial, sans-serif; margin:0; background:#e8f5e8; color:#333;}
        .container {max-width:900px; margin:20px auto; padding:20px; background:white; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.1);}
        h1 {text-align:center; color:#1b5e20;}
        #info {text-align:center; font-weight:bold; color:#d50000; margin:10px;}
        #timer {text-align:center; font-size:24px; color:#d50000; margin:15px 0;}
        .question {margin:25px 0; padding:15px; background:#f1f8e9; border-radius:10px;}
        .options {display:grid; gap:12px;}
        .option {padding:15px; background:#e8f5e8; border:2px solid #81c784; border-radius:8px; cursor:pointer;}
        .option:hover {background:#c8e6c9;}
        .option.selected {background:#81c784; color:white;}
        .option.correct {background:#4caf50; color:white; font-weight:bold;}
        .option.incorrect {background:#f44336; color:white;}
        button {background:#2e7d32; color:white; padding:12px 25px; border:none; border-radius:8px; font-size:16px; cursor:pointer; margin:10px;}
        button:hover {background:#1b5e20;}
        #result, #answers {text-align:center; margin:30px 0; font-size:18px;}
        .hidden {display:none;}
        .back-btn {background:#607d8b;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Thi Trắc Nghiệm Chứng Chỉ Môi Giới BĐS</h1>
        <div id="info">Đề thi gồm 50 câu (ngẫu nhiên từ bộ câu hỏi)</div>
        <div id="timer">Thời gian: 45:00</div>
        <div id="quiz"></div>
        <div style="text-align:center;">
            <button id="submit" onclick="submitQuiz()">Nộp Bài</button>
            <button onclick="restartQuiz()">Làm Lại</button>
            <button class="back-btn" onclick="location.href='index.html'">Quay lại ôn tập</button>
        </div>
        <div id="result" class="hidden"></div>
        <div id="answers" class="hidden"></div>
    </div>

    <script src="questions.js"></script>
    <script>
        let current = [], user = [], timeLeft = 45*60, timer;

        function shuffle(a) { 
            for (let i = a.length-1; i > 0; i--) { 
                const j = Math.floor(Math.random() * (i + 1)); 
                [a[i], a[j]] = [a[j], a[i]]; 
            } 
            return a; 
        }

        function init() {
            let allQuestions = shuffle([...questions]);
            current = allQuestions.slice(0, 50);
            user = new Array(50).fill(-1);
            display();
            startTimer();
        }

        function display() {
            document.getElementById('quiz').innerHTML = current.map((q, i) => `
                <div class="question">
                    <strong>Câu ${i+1}:</strong> ${q.question}
                    <div class="options">
                        ${q.options.map((opt, j) => `
                            <div class="option" onclick="choose(${i},${j})">${String.fromCharCode(65+j)}. ${opt}</div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function choose(qIdx, optIdx) {
            user[qIdx] = optIdx;
            document.querySelectorAll(`.question:nth-child(${qIdx+1}) .option`).forEach((el, j) => {
                el.classList.toggle('selected', j === optIdx);
            });
        }

        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                let m = String(Math.floor(timeLeft/60)).padStart(2,'0');
                let s = String(timeLeft%60).padStart(2,'0');
                document.getElementById('timer').textContent = `Thời gian: ${m}:${s}`;
                if (timeLeft <= 0) submitQuiz();
            }, 1000);
        }

        function submitQuiz() {
            clearInterval(timer);
            document.getElementById('submit').disabled = true;

            let score = 0;
            let detail = '<h2>Đáp án chi tiết:</h2>';

            current.forEach((q, i) => {
                let opts = document.querySelectorAll(`.question:nth-child(${i+1}) .option`);
                const correctIdx = q.correct;  // Dùng q.correct (index 0-3)
                if (user[i] === correctIdx) {
                    score++;
                    opts[user[i]].classList.add('correct');
                } else {
                    if (user[i] !== -1) opts[user[i]].classList.add('incorrect');
                    opts[correctIdx].classList.add('correct');
                }
                const correctLetter = String.fromCharCode(65 + correctIdx);
                detail += `<p><strong>Câu ${i+1}:</strong> Đáp án đúng: <strong>${correctLetter}. ${q.options[correctIdx]}</strong></p>`;
            });

            let percent = (score/50*100).toFixed(1);
            document.getElementById('result').innerHTML = `
                <h2>Kết quả: ${score}/50 điểm (${percent}%)</h2>
                ${percent >= 80 ? 'XUẤT SẮC! ĐẬU CHẮC!' : percent >= 70 ? 'Tốt, gần đậu rồi!' : 'Ôn lại đi bro!'}
                <br><button onclick="document.getElementById('answers').classList.remove('hidden')">Xem đáp án chi tiết</button>
            `;
            document.getElementById('answers').innerHTML = detail;
            document.getElementById('result').classList.remove('hidden');
        }

        function restartQuiz() {
            timeLeft = 45*60;
            document.getElementById('result').classList.add('hidden');
            document.getElementById('answers').classList.add('hidden');
            document.getElementById('submit').disabled = false;
            init();
        }

        init();
    </script>
</body>
</html>
